# Dakka

[![CI](https://github.com/roboportal/dakka/actions/workflows/ci.yml/badge.svg)](https://github.com/roboportal/dakka/actions/workflows/ci.yml)
[![Integration](https://github.com/roboportal/dakka/actions/workflows/integration.yml/badge.svg)](https://github.com/roboportal/dakka/actions/workflows/integration.yml)

<div align="center">
  <svg viewBox="-107.323 82 407.284 149.257" width="180px" height="60px" xmlns="http://www.w3.org/2000/svg">
    <ellipse fill="#1f92a1"  style="stroke-width: 1.44479; vector-effect: non-scaling-stroke;" cx="-64.81" cy="156.63" rx="19.242" ry="19.373"/>
    <path fill="#808080" style="" d="M 23.351 182.429 L 23.007 130.16 L 27.225 130.102 C 47.742 129.608 49.135 181.681 27.172 182.436 Z M 9.534 120.529 L 9.207 192.715 C 9.171 194.986 9.776 195.007 11.202 195.051 L 29.105 195.227 C 66.966 194.01 65.336 121.801 32.981 117.485 L 12.474 117.376 C 10.676 117.309 9.471 117.928 9.534 120.529 Z"/>
    <rect fill="#808080" x="-11.86" y="82" width="7.981" height="149.257" style="paint-order: stroke;"/>
    <path fill="#808080" d="M 97.352 171.392 L 87.92 171.237 L 93.169 150.338 Z M 70.207 195.691 L 81.749 195.526 C 82.452 195.53 82.897 194.796 82.991 194.214 L 84.814 185.769 C 85.19 185.106 85.406 185.104 85.825 185.115 L 99.823 185.025 C 100.021 185.016 100.287 185.251 100.512 185.624 L 103.516 194.602 C 103.888 195.257 104.22 195.654 105.219 195.574 L 114.885 195.432 C 115.953 195.379 116.192 194.862 116.198 193.772 L 100.411 118.906 C 100.165 117.833 99.831 117.367 99.213 117.294 L 87.341 117.204 C 86.561 117.241 86.039 117.779 85.857 118.48 L 69.379 194.307 C 69.213 195.142 69.611 195.681 70.207 195.691 Z" style=""/>
    <path fill="#808080" d="M 281.115 171.703 L 271.683 171.548 L 276.932 150.649 Z M 253.97 196.002 L 265.512 195.837 C 266.215 195.841 266.66 195.107 266.754 194.525 L 268.577 186.08 C 268.953 185.417 269.169 185.415 269.588 185.426 L 283.586 185.336 C 283.784 185.327 284.05 185.562 284.275 185.935 L 287.279 194.913 C 287.651 195.568 287.983 195.965 288.982 195.885 L 298.648 195.743 C 299.716 195.69 299.955 195.173 299.961 194.083 L 284.174 119.217 C 283.928 118.144 283.594 117.678 282.976 117.605 L 271.104 117.515 C 270.324 117.552 269.802 118.09 269.62 118.791 L 253.142 194.618 C 252.976 195.453 253.374 195.992 253.97 196.002 Z" style=""/>
    <path fill="#808080" style="" d="M 128.478 119.026 L 128.836 194.388 C 128.827 195.476 129.049 196.085 129.847 196.208 L 141.6 196.166 C 142.722 196.239 142.916 195.747 142.975 195.17 L 142.688 163.106 C 142.743 161.953 143.876 161.931 144.283 163.044 L 163.554 195.483 C 164.154 196.302 164.431 196.067 165.179 196.171 L 177.508 195.917 C 178.643 195.813 178.647 194.444 178.312 193.686 L 156.427 155.327 C 155.763 154.211 155.831 153.338 156.346 152.654 L 175.163 120.112 C 175.654 119.104 175.332 117.743 174.407 117.677 L 161.238 117.642 C 160.588 117.586 160.197 117.98 159.551 119.183 L 143.871 148.405 C 143.534 149.241 142.407 149.223 142.419 148.367 L 142.703 119.022 C 142.775 117.779 142.415 116.96 141.336 116.891 L 130.696 116.895 C 129.38 116.852 128.481 117.598 128.478 119.026 Z"/>
    <path fill="#808080" style="" d="M 191.485 119.184 L 191.843 194.546 C 191.834 195.634 192.056 196.243 192.854 196.366 L 204.607 196.324 C 205.729 196.397 205.923 195.905 205.982 195.328 L 205.695 163.264 C 205.75 162.111 206.883 162.089 207.29 163.202 L 226.561 195.641 C 227.161 196.46 227.438 196.225 228.186 196.329 L 240.515 196.075 C 241.65 195.971 241.654 194.602 241.319 193.844 L 219.434 155.485 C 218.77 154.369 218.838 153.496 219.353 152.812 L 238.17 120.27 C 238.661 119.262 238.339 117.901 237.414 117.835 L 224.245 117.8 C 223.595 117.744 223.204 118.138 222.558 119.341 L 206.878 148.563 C 206.541 149.399 205.414 149.381 205.426 148.525 L 205.71 119.18 C 205.782 117.937 205.422 117.118 204.343 117.049 L 193.703 117.053 C 192.387 117.01 191.488 117.756 191.485 119.184 Z"/>
    <path fill="#808080" d="M -22.296 156.63 C -22.296 179.957 -41.33 198.869 -64.81 198.869 C -88.288 198.869 -107.323 179.957 -107.323 156.63 C -107.323 133.3 -88.288 114.389 -64.81 114.389 C -41.33 114.389 -22.296 133.3 -22.296 156.63 Z M -64.81 120.445 C -84.923 120.445 -101.228 136.646 -101.228 156.63 C -101.228 176.613 -84.923 192.813 -64.81 192.813 C -44.697 192.813 -28.391 176.613 -28.391 156.63 C -28.391 136.646 -44.697 120.445 -64.81 120.445 Z" style=""/>
  </svg>
  <h3>Generate tests for Cypress, Playwright and Puppeteer using Dakka</3>
</div>

<div align="center">
  <a href="https://chrome.google.com/webstore/detail/dakka/gllikifiancbeplnkdnpnmmhhlncghej" target="_blank" rel="noreferrer">Dakka Chrome Extension</a> |
  <a href="https://www.dakka.dev/" target="_blank" rel="noreferrer">Documentation</a>
</div>

## What's Dakka?

Dakka is an open source Chrome Extension which helps to generate end-to-end tests for Cypress, Playwright and Puppeteer.

### Demo

Demo website link: https://roboportal.io/

![Capture 2022-02-22 at 00 22 29](https://user-images.githubusercontent.com/7383804/155093359-37df3741-4010-4c26-a93a-4fdfa02ed336.gif)

## Installing

To install Dakka click <a href="https://chrome.google.com/webstore/detail/dakka/gllikifiancbeplnkdnpnmmhhlncghej" target="_blank" rel="noreferrer">Chrome extension</a> and this will take you to Chrome Web Store. Follow next steps to start generating tests:

1. Open Chrome devtools
2. Enable Dakka
3. Click Record button
4. Start interacting with the page

<br/>
<div align="center">
<img width="760" alt="Screenshot 2022-02-16 at 11 01 27 PM" src="https://user-images.githubusercontent.com/7383804/154786735-1fd140c2-3515-4978-a52e-3bb26e3e8c3a.png">
</div>

## Adding Assertions

Assertion Blocks are validation steps, which are converted to assertion logic such as <code>cy.get('#loading').should('not.exist')</code>.
To add an assertion hover over the floating plus sign and drag and drop assertion block.

<br/>
<div align="center">
<img width="760" alt="Screenshot 2022-02-16 at 11 01 28 PM" src="https://user-images.githubusercontent.com/7383804/154787750-16716f68-40d1-4360-bc96-0152128a635a.gif">
</div>
<br/>

After adding Assertion Block you will need to configure assertion logic - locate the element on the page or manually add the element selector, choose the assertion from dropdown and edit the value if needed.

<br/>
<div align="center">
<img width="360" alt="Screenshot 2022-02-19 at 12 44 36 AM" src="https://user-images.githubusercontent.com/7383804/154793765-c04130a5-b061-415a-9abe-9f23a9e802a0.png">
<img width="450" alt="Screenshot 2022-02-19 at 12 41 22 AM" src="https://user-images.githubusercontent.com/7383804/154793730-57da26b3-9408-455a-a2c8-1a406f3a272d.png">
</div>

## Choosing Selectors

Dakka suggests the list of best possible selectors for the elements on the page.

<div align="center">
<img width="560" alt="Screenshot 2022-02-16 at 11 01 29 PM" src="https://user-images.githubusercontent.com/7383804/154788192-b5376c0d-c9f2-4a25-afc2-aad98939aa5c.png">
</div>

<br/>
Selectors are sorted by priority with green, red and yellow icons. First selector is pre-selected by default. Hover over the icon to get the element count on the page by selector.
<br/>

## Delete events

If generated events contain any entries that aren't required for the test use the Delete button located at the bottom of the event block.

## Exporting

Generated test can be copied to clipboard or downloaded as a file and added to the project.

<div align="center">
<img width="760" alt="Screenshot 2022-02-16 at 11 01 29 PM" src="https://user-images.githubusercontent.com/7383804/154789533-2ed4c538-7f9b-4cbb-86bf-6be11889b87b.gif">
</div>

## Contributing

### Package content

- `src/background` - service-worker
- `src/devTools` - creating tab for dev panel
- `src/contentScript` - content and injectable scripts. Content has access to inspected DOM page, but is executed in different global context. Injectable is embedded to the document to intercept events.
- `src/panel` - dev tool UI app
- `src/testPage` - test application to debug tool
- `src/manifest.json` - extension manifest

### Development

Run `npm i` and `npm start` to start development. It will run webpack dev server on the 8080 port. To get the test page use: `http://127.0.0.1:8080/testPage/testPage.html`

### Testing

Run `npm test` to execute the testsuite. To update mocks of generated tests execute `UPDATE_OUT=true npm run test`

### Build details

There are two webpack configs to bundle the extension:

- `webpack.panel.config.js` - builds devTool and panel pages. This config supports HMR.
- `webpack.scripts.config.js`- builds background, content and injection scripts. This part doesn't use HMR cause it leads to the behaviour when the panel app stops receiving chrome.runtime messages from content and background scripts.

It's noticed, that when multiple webpack processes work concurrently, it might cause a stale dev-server port after stopping the processes. To clean up such a process use `kill:stale-dev-server`.

## Using remote devtools

To use React and Redux devtools, start the servers first: `npm run devtools`. In redux-devtools panel open `Settings` and select `use local` option in the `Connection` tab. The hostname should be `localhost`, and the port should be `8000`.

### Building for production

Run to create production build: `npm run build` and `npm run pack` to compress it as zip file.
